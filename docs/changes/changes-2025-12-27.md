# Changes Log - 2025-01-27

## What Changed

Converted the general AI chat application into a Health Doctor AI application with comprehensive health-focused features, branding, and compliance components.

### Core Health Features

1. **Health Profile Store** (`src/features/health/store/healthProfileStore.ts`)
   - New Zustand store to manage user health information
   - Tracks symptoms, conditions, medications, allergies, and general notes
   - Persists to AsyncStorage and syncs with Supabase
   - Provides health context for AI conversations

2. **Health Information Extraction Service** (`src/services/healthExtractionService.ts`)
   - Automatically extracts health information from user messages
   - Uses keyword matching for symptoms, conditions, medications, and allergies
   - Supports AI-assisted extraction for better accuracy

3. **Dynamic Medical System Prompt** (`src/features/chat/store/chatStore.ts`)
   - Added medical system prompt to all conversations
   - Dynamically includes user's health profile context
   - Updates system message when health profile changes
   - Includes emergency disclaimers

4. **Health Profile UI** (`src/features/health/components/HealthProfileScreen.tsx`)
   - Full-screen component for managing health profile
   - Add/remove symptoms, conditions, medications, allergies
   - Edit general health notes
   - Accessible from Settings menu

5. **Auto-Update Health Profile**
   - Automatically extracts and saves health information from conversations
   - Updates health profile after each user message
   - Profile grows organically from conversations

### UI/UX Updates

6. **Medical Theme & Branding**
   - Updated color scheme: Purple (#9B8AFF) → Medical Blue (#3B82F6)
   - Changed icons: "sparkles" → "medical" icons throughout
   - Updated glassmorphism theme colors
   - All components now use medical blue for AI elements

7. **Health-Focused Empty State** (`src/features/chat/components/EmptyChat.tsx`)
   - Updated title: "How can I help with your health today?"
   - Updated subtitle with health-focused messaging
   - Replaced generic suggestions with health-specific ones:
     - Symptom questions
     - Medication info
     - Wellness advice
     - Health condition explanations

8. **Medical Disclaimer Component** (`src/components/shared/MedicalDisclaimer.tsx`)
   - Modal variant for first-time users
   - Collapsible banner variant for ongoing display
   - Includes emergency service information
   - Persistent acceptance state via AsyncStorage

9. **Emergency Warning Component** (`src/components/shared/EmergencyWarning.tsx`)
   - Detects emergency keywords in user messages
   - Shows prominent warning banner when detected
   - Includes call-to-action for emergency services
   - Dismissible with animation

### Content Updates

10. **Conversation Titles** (`src/features/chat/api/openRouterClient.ts`)
    - Updated title generation to create health-focused titles
    - Examples: "Headache Consultation", "Medication Question", "Sleep Advice"

11. **Model Descriptions** (`src/features/chat/types.ts`)
    - Updated all model descriptions to be health-focused
    - Examples: "Best for complex medical questions", "Fast responses for general health queries"

12. **Settings Screen** (`src/features/chat/screens/SettingsScreen.tsx`)
    - Added Health Profile section with management button
    - Updated API key descriptions to mention health consultations
    - Integrated HealthProfileScreen modal

### App Metadata

13. **App Configuration**
    - `app.json`: Updated name to "HealthDoc AI", slug to "healthdoc-ai"
    - Bundle IDs: iOS `com.healthdoc.ai`, Android `com.healthdoc.ai`
    - Updated permission descriptions for health consultations
    - Scheme changed to `healthdoc`
    - `package.json`: Updated name to `healthdoc-ai`

## Why It Changed

The application was converted from a general-purpose AI assistant to a specialized health doctor AI to:
- Provide personalized medical consultations based on user's health profile
- Maintain user's health information across conversations
- Offer health-focused suggestions and guidance
- Include proper medical disclaimers and emergency warnings
- Create a professional medical-themed user experience

## How It Affects Current Code

### New Dependencies
- No new npm packages required (uses existing Zustand, AsyncStorage, Supabase)

### Database Changes
- Requires Supabase table `health_profiles` with schema:
  ```sql
  CREATE TABLE health_profiles (
    user_id UUID PRIMARY KEY REFERENCES auth.users(id),
    profile JSONB NOT NULL,
    updated_at TIMESTAMPTZ DEFAULT NOW()
  );
  ```

### Breaking Changes
- None - all existing functionality is preserved

### Integration Points
- `ChatScreen.tsx`: Added MedicalDisclaimer and EmergencyWarning components
- `chatStore.ts`: Integrated health profile extraction and system prompt generation
- `SettingsScreen.tsx`: Added health profile management
- All chat components: Updated colors and icons to medical theme

## Developer Notes

### Next Steps

1. **Database Setup**: Create the `health_profiles` table in Supabase:
   ```sql
   CREATE TABLE IF NOT EXISTS health_profiles (
     user_id UUID PRIMARY KEY REFERENCES auth.users(id),
     profile JSONB NOT NULL DEFAULT '{"symptoms":[],"conditions":[],"medications":[],"allergies":[],"generalNotes":"","lastUpdated":0}'::jsonb,
     updated_at TIMESTAMPTZ DEFAULT NOW()
   );
   ```

2. **Testing**:
   - Test health profile extraction from various message formats
   - Verify system prompt includes health context correctly
   - Test emergency keyword detection
   - Verify disclaimer modal shows on first launch
   - Test health profile sync with Supabase

3. **Optional Enhancements**:
   - Add health profile export/import
   - Add health data visualization
   - Add medication reminders
   - Enhance AI extraction accuracy with model fine-tuning

### Important Notes

- Health information is stored locally and synced to Supabase when user is logged in
- System prompt is automatically added to each conversation with latest health context
- Emergency warnings are shown based on keyword detection - consider enhancing with ML model
- All medical disclaimers are prominently displayed as required for health apps
- Color theme changes are backward compatible - existing conversations remain functional

